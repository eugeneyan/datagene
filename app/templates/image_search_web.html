<!DOCTYPE html>
<html lang="en">

<head>
    <title>Product search using image</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">
    <link href="../static/css/fileinput.css" media="all" rel="stylesheet" type="text/css"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../static/js/fileinput.js" type="text/javascript"></script>
    <script src="../static/js/fileinput_locale_fr.js" type="text/javascript"></script>
    <script src="../static/js/fileinput_locale_es.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!--<link rel="stylesheet" href="../static/css/styles.css">-->
</head>

<body>
<div class="container">

    <nav>
        <ul class="nav nav-pills pull-right">
            <li role="presentation"><a href="{{ url_for('index') }}">Back to Home</a></li>
        </ul>
    </nav>

    <div class="header">
        <h3 class="text-muted">Product Search using image</h3>
    </div>

    <p>Searches for products based on image.</p>

    <form enctype="multipart/form-data" action="{{ url_for('image_search_web') }}" method="POST">
        <div class="input-group">
            <label class="input-group-btn">
                <span class="btn btn-primary">
                    Browse &hellip; <input type="file" name="image" style="display: none;" multiple>
                </span>
            </label>
            <input type="text" class="form-control" readonly>
        </div>
        <span class="help-block">
            Browse and select a file
        </span>

        <br>

        <div class="form-group">
            <label class="btn btn-primary"> Submit <input type="submit" style="display: none;" value="submit"> </label>
        </div>
    </form>

    <div class="form-inline">
        {% for key, value in result.iteritems() %}
        <div class="form-group">
        <div class="card" style="width: 22rem; height: 32rem; border-style: solid; border-color: #AEB6BF;
        border-width: 1.5px; margin: 5px; border-radius: 5px; padding: 10px;">
            <div class="card-image" style="width: 20rem; height: 15rem">
                <img class="img-responsive" src="{{url_for('static', filename='{}'.format(value[0]), width=100)}}"
                     alt="Product image" style="border-radius: 10px; max-height: 100%; max-width: 100%;
                     margin-left: auto; margin-right: auto;">
            </div>
            <div class="card-block">
                <h5 class="card-text">{{ '{}'.format(value[1]) }}</h5>
                <p class="card-text" style="color: #808B96; font-size: 12px; text-overflow: ellipsis;">
                    {{ 'Category: {}'.format(value[2]) }}</p>
            </div>
        </div>
        </div>
        {% endfor %}
    </div>

    <br>
    <ul class="list-group">
        <li style="text-align: left" class="list-group-item"> {{ 'Time taken: {:.2f} milliseconds'.format(elapsed_time) }}</li>
    </ul>

    <footer class="footer">
        <p>&copy; eugeneyan 2016</p>
    </footer>
</div>
</body>

<script>
    jQuery(function(){

    var minimized_elements = $('h5.card-text');

    minimized_elements.each(function(){
        var t = $(this).text();
        if(t.length < 100) return;

        $(this).html(
            t.slice(0,100)+'<span>... </span><a href="#" class="more">More</a>'+
            '<span style="display:none;">'+ t.slice(100,t.length)+' <a href="#" class="less">Less</a></span>'
        );

    });

    $('a.more', minimized_elements).click(function(event){
        event.preventDefault();
        $(this).hide().prev().hide();
        $(this).next().show();
    });

    $('a.less', minimized_elements).click(function(event){
        event.preventDefault();
        $(this).parent().hide().prev().show().prev().show();
    });

    });

    jQuery(function(){

    var minimized_elements = $('p.card-text');

    minimized_elements.each(function(){
        var t = $(this).text();
        if(t.length < 100) return;

        $(this).html(
            t.slice(0,100)+'<span>... </span><a href="#" class="more">More</a>'+
            '<span style="display:none;">'+ t.slice(100,t.length)+' <a href="#" class="less">Less</a></span>'
        );

    });

    $('a.more', minimized_elements).click(function(event){
        event.preventDefault();
        $(this).hide().prev().hide();
        $(this).next().show();
    });

    $('a.less', minimized_elements).click(function(event){
        event.preventDefault();
        $(this).parent().hide().prev().show().prev().show();
    });

    });


    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-85787628-1', 'auto');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');


    $(function() {

      // We can attach the `fileselect` event to all file inputs on the page
      $(document).on('change', ':file', function() {
        var input = $(this),
            numFiles = input.get(0).files ? input.get(0).files.length : 1,
            label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
        input.trigger('fileselect', [numFiles, label]);
      });

      // We can watch for our custom `fileselect` event like this
      $(document).ready( function() {
          $(':file').on('fileselect', function(event, numFiles, label) {

              var input = $(this).parents('.input-group').find(':text'),
                  log = numFiles > 1 ? numFiles + ' files selected' : label;

              if( input.length ) {
                  input.val(log);
              } else {
                  if( log ) alert(log);
              }

          });
      });

    });
</script>
</html>
